import 'dart:math';
import '../../features/profile/user_profile.dart';

/// Local Turkish fallback generator used when remote AI is unavailable.
/// Produces clean UTF-8 Turkish texts for all reading types.
class LocalAIGenerator {
  static String generate({
    required String type, // coffee|tarot|palm|astro|dream|live_chat
    required UserProfile profile,
    int? seed,
    Map<String, dynamic>? extras,
    String locale = 'tr',
  }) {
    final rnd = Random(seed ?? DateTime.now().millisecondsSinceEpoch);
    final name = profile.name.isEmpty ? 'Sevgili ruh' : profile.name;
    final zodiac = profile.zodiac.isEmpty ? 'burcun' : profile.zodiac;

    if (type == 'coffee') {
      final mood = _pick(rnd, ['sakin', 'umutlu', 'iÃ§ten', 'aydÄ±nlÄ±k']);
      final arc = _pick(rnd, ['yenilenme', 'netleÅŸme', 'cesaret', 'denge']);
      return (
        '$name, fincandaki telve desenleri $mood bir tonda; hayatÄ±nda $arc temasÄ±nÄ± Ã¶ne Ã§Ä±karÄ±yor.\n\n'
        'Genel Ã‡erÃ§eve:\n'
        'Spiral ve kÄ±vrÄ±mlar, dÃ¼ÅŸÃ¼ncelerin yavaÅŸ yavaÅŸ bir merkezde toplanmasÄ±na iÅŸaret. '
        'Son gÃ¼nlerde beliren kÃ¼Ã§Ã¼k iÅŸaretler (zamanlamalar, tekrar eden kelimeler) dikkati baÅŸlÄ±ca konuya Ã§ekiyor.\n\n'
        'Birinci Fincan:\n'
        'Kenar Ã§izgilerine yakÄ±n kÃ¼Ã§Ã¼k yÄ±ldÄ±z benzeri noktalar, Ã§evrenden gelen destekleri anlatÄ±r. '
        'Kalbini yoran alanlarda kÃ¼Ã§Ã¼k ama net sÄ±nÄ±rlar koyduÄŸunda, iÃ§ huzurun hÄ±zla gÃ¼Ã§lenecek.\n\n'
        'Ä°kinci Fincan:\n'
        'Merkeze yakÄ±n dalga izleri, bir kararÄ±n olgunlaÅŸtÄ±ÄŸÄ±nÄ± gÃ¶steriyor. '
        'Kendine bir hafta ver; her gÃ¼n 10 dakikalÄ±k odakla bu kararÄ±n en pratik ilk adÄ±mÄ±nÄ± yaz.\n\n'
        'Tabak Ã–ykÃ¼sÃ¼:\n'
        'Tabakta kalan ince Ã§izgiler, â€œeÅŸiÄŸi aÃ§maâ€ temasÄ±nÄ± Ã§aÄŸrÄ±ÅŸtÄ±rÄ±yor. '
        'Eski bir alÄ±ÅŸkanlÄ±ÄŸÄ± nazikÃ§e bÄ±rakmak, yeni olana alan aÃ§acak.\n\n'
        'Ã–neriler:\n'
        'â€¢ BugÃ¼n 3 cÃ¼mle niyet yaz.\n'
        'â€¢ AkÅŸam 5 dakika nefes ve esneme.\n\n'
        'Not: Bu okuma eÄŸlence amaÃ§lÄ±dÄ±r; kararlarÄ±nda kendi sezgini ve gerekirse uzman gÃ¶rÃ¼ÅŸÃ¼nÃ¼ Ã¶ncele.'
      );
    }

    if (type == 'tarot') {
      final names = (extras?['cards'] is List)
          ? (extras!['cards'] as List).map((e) => e.toString()).toList()
          : <String>[];
      final past = names.isNotEmpty ? names[0] : _pick(rnd, ['GeÃ§miÅŸ kartÄ±', 'Bir Ã¶nceki adÄ±m']);
      final present = names.length > 1 ? names[1] : _pick(rnd, ['Åimdi kartÄ±', 'Odak noktan']);
      final future = names.length > 2 ? names[2] : _pick(rnd, ['Gelecek kartÄ±', 'Ufuk kartÄ±']);
      final theme = _pick(rnd, ['sabÄ±r', 'cesaret', 'iÃ§sel dÃ¼rÃ¼stlÃ¼k', 'yaratÄ±cÄ±lÄ±k']);
      return (
        '$name, seÃ§tiÄŸin Ã¼Ã§ kartÄ±n dili yumuÅŸak ama belirgin.\n\n'
        'GeÃ§miÅŸ ($past): $theme ile sÄ±nanmÄ±ÅŸ dÃ¶nemler, Ã¶ÄŸrenilen dersleri parlatÄ±yor. '
        'Geride bÄ±raktÄ±klarÄ±n artÄ±k yÃ¼k deÄŸil; deneyim. Kendini yargÄ±lamak yerine ÅŸefkatle kabullenmek, '
        'bir sonraki hamleyi aydÄ±nlatÄ±yor.\n\n'
        'Åimdi ($present): Kalbini sakinleÅŸtiren kÃ¼Ã§Ã¼k bir ritÃ¼el (nefes, mum, niyet) sezgini keskinleÅŸtirir. '
        'GÃ¼n iÃ§inde Ã¼Ã§ derin nefes + kÄ±sa bir yÃ¼rÃ¼yÃ¼ÅŸ, zihni berraklaÅŸtÄ±rÄ±r ve konuÅŸmalarÄ±na denge taÅŸÄ±r. '
        'GÃ¼vendiÄŸin iki kÃ¼Ã§Ã¼k adÄ±mÄ± bugÃ¼n planlayabilirsin.\n\n'
        'Gelecek ($future): Ufak ama anlamlÄ± bir adÄ±m, beklenen kapÄ±yÄ± aralayabilir. '
        'SabÄ±rlÄ± ama kararlÄ± ilerleyiÅŸ, yoluna eÅŸlik eden kapÄ±larÄ± birer birer aÃ§acak. '
        'Kendine nazik ol; evren, net niyetinle hizalanÄ±yor.\n\n'
        'KapanÄ±ÅŸ: Ä°Ã§ sesinin rehberliÄŸine gÃ¼ven. Bir bardak suyla niyetini tazele, '
        'akÅŸam kÄ±sa bir ÅŸÃ¼kran cÃ¼mlesiyle gÃ¼nÃ¼ tamamla. IÅŸÄ±ÄŸÄ±n yolunla olsun.'
      );
    }

    if (type == 'palm') {
      final tone = _pick(rnd, ['sakin', 'ÅŸefkatli', 'ilham verici', 'gerÃ§ekÃ§i']);
      final heart = _pick(rnd, ['derin baÄŸ kurma ihtiyacÄ±', 'sÄ±nÄ±r koyma becerisi', 'duygularÄ±nÄ± ifade etme cesareti']);
      final head = _pick(rnd, ['yaratÄ±cÄ± dÃ¼ÅŸÃ¼nme', 'analitik bakÄ±ÅŸ', 'pratik zeka']);
      final life = _pick(rnd, ['istikrarlÄ± gÃ¼Ã§', 'dalgasal enerji', 'yÃ¼ksek toparlanma gÃ¼cÃ¼']);
      final fate = _pick(rnd, ['kariyer dÃ¼ÅŸÃ¼nmeleri', 'kendi yolunu Ã§izme', 'sorumluluk artÄ±ÅŸÄ±']);
      return (
        '$name, avucundaki Ã§izgiler $tone bir anlatÄ± sunuyor.\n\n'
        'Kalp Ã‡izgisi: $heart Ã¶ne Ã§Ä±kÄ±yor. KÃ¼Ã§Ã¼k ama net sÄ±nÄ±rlar, iliÅŸkilerinde huzuru bÃ¼yÃ¼tÃ¼r.\n'
        'BaÅŸ Ã‡izgisi: $head seni destekliyor. GÃ¼nde 10 dakikalÄ±k odak yÃ¼rÃ¼yÃ¼ÅŸÃ¼, zihni berraklaÅŸtÄ±rÄ±r.\n'
        'YaÅŸam Ã‡izgisi: $life. Dinlenmeâ€“hareket dengesi, enerji kaliteni artÄ±rÄ±r.\n'
        'Kader Ã‡izgisi: $fate. Ufak adÄ±mlarÄ±n toplamÄ±, kapÄ±larÄ±n aÃ§Ä±lÄ±ÅŸÄ±nÄ± hÄ±zlandÄ±rÄ±r.\n\n'
        'Ã–neriler:\n'
        'â€¢ HaftalÄ±k mini ritÃ¼el: mum, mÃ¼zik, niyet.\n'
        'â€¢ Bir cÃ¼mle ÅŸÃ¼kran, bir bardak su.\n\n'
        'Not: Bu okuma eÄŸlence amaÃ§lÄ±dÄ±r; kararlarÄ±nda sezgini ve gerekirse uzman gÃ¶rÃ¼ÅŸÃ¼nÃ¼ Ã¶ncele.'
      );
    }

    if (type == 'dream') {
      final input = (extras?['text'] ?? '').toString().replaceAll('\n', ' ').trim();
      final preview = input.isEmpty ? 'â€”' : (input.length > 160 ? input.substring(0, 160) + 'â€¦' : input);
      const stopWords = {
        've','ile','ama','fakat','lakin','Ã§Ã¼nkÃ¼','ancak','ya','de','da','ki','iÃ§in','gibi','Ã§ok','bir','biraz',
        'beni','bana','ben','sen','o','biz','siz','onlar','mÄ±','mi','mu','mÃ¼','gÃ¼n','gece','rÃ¼ya','rÃ¼yam','rÃ¼yada',
        'rÃ¼yamda','gÃ¶rdÃ¼m','gÃ¶rdÃ¼ÄŸÃ¼m','vardÄ±','yoktu','hala','hep','daha'
      };
      List<String> tokenize(String s) => s
          .toLowerCase()
          .split(RegExp(r'[^a-zA-ZÃ§ÄŸÄ±Ã¶ÅŸÃ¼0-9]+'))
          .where((w) => w.length >= 3 && !stopWords.contains(w) && !RegExp(r'^\d+$').hasMatch(w))
          .toList();
      String stem(String w) {
        var x = w.toLowerCase();
        const suffixes = [
          'larÄ±','leri','larda','lerde','lardan','lerden','lara','lere',
          'lar','ler','Ä±mÄ±z','imiz','umuz','Ã¼mÃ¼z','mÄ±z','miz','muz','mÃ¼z',
          'Ä±m','im','um','Ã¼m','m','sÄ±nÄ±z','siniz','sunuz','sÃ¼nÃ¼z','sÄ±n','sin','sun','sÃ¼n',
          'dÄ±r','dir','dur','dÃ¼r','tÄ±r','tir','tur','tÃ¼r','dan','den','tan','ten',
          'lik','lÄ±k','luk','lÃ¼k','ci','cÄ±','cu','cÃ¼','Ã§i','Ã§Ä±','Ã§u','Ã§Ã¼'
        ];
        for (final s in suffixes) {
          if (x.endsWith(s) && x.length - s.length >= 3) { x = x.substring(0, x.length - s.length); break; }
        }
        const synsets = {
          'araba': ['otomobil','oto','taÅŸÄ±t','araÃ§','arac'],
          'ev': ['hane','konut','yuva'],
          'yol': ['rota','seyahat','yolculuk','gezi'],
          'su': ['deniz','nehir','okyanus','gÃ¶l','sular'],
          'kedi': ['pisi','pisicik','ked'],
          'kÃ¶pek': ['it','dog','kopek'],
          'yÄ±lan': ['yilan','ejder'],
          'uÃ§ak': ['ucak','uÃ§uÅŸ','ucus'],
          'para': ['nakit','kasa','kumbara'],
          'aÅŸk': ['sevgi','ask','iliÅŸki','iliski','partner'],
          'iÅŸ': ['Ã§alÄ±ÅŸma','calisma','kariyer','meslek','iÅŸyeri','isyeri'],
          'okul': ['ders','sÄ±nÄ±f','sinif','Ã¶ÄŸretmen','ogretmen'],
          'Ã¶lÃ¼m': ['olum','vefat','kayÄ±p','kayip','yitim'],
          'korku': ['endiÅŸe','kaygÄ±','kabus'],
          'diÅŸ': ['dis','diÅŸler','disler'],
          'bebek': ['Ã§ocuk','cocuk','yavru'],
        };
        for (final e in synsets.entries) {
          if (e.value.contains(x)) return e.key;
        }
        return x;
      }
      final tokens = tokenize(input).map(stem).toList();
      final counts = <String,int>{};
      for (final t in tokens) { counts[t] = (counts[t] ?? 0) + 1; }
      final sorted = counts.keys.toList()
        ..sort((a,b){ final c = (counts[b]!-counts[a]!); return c!=0?c: b.length.compareTo(a.length); });
      final keys = sorted.take(6).toList();
      final sym = keys.isNotEmpty ? keys.join(', ') : _pick(rnd, ['su', 'yol', 'merdiven', 'kapÄ±', 'gÃ¶lge']);
      final tone = _pick(rnd, ['dingin', 'yoÄŸun', 'umutlu', 'dÃ¼ÅŸÃ¼nceli']);
      return (
        '$name, rÃ¼yanda Ã¶ne Ã§Ä±kanlar: $preview\n\n'
        'Semboller (anahtarlar): $sym\n'
        'Bu bÃ¼tÃ¼n $tone bir enerji taÅŸÄ±yor ve mesajÄ±nÄ± duyguda netleÅŸtiriyor.\n\n'
        'Duygusal Ton:\n'
        'RÃ¼ya, iÃ§ dÃ¼nyanda duyguâ€“zihin dengesini Ã§aÄŸÄ±rÄ±yor. KÃ¼Ã§Ã¼k bir es verme, kendine ÅŸefkat alanÄ± aÃ§ar.\n\n'
        'GÃ¼nlÃ¼k YansÄ±ma:\n'
        'BugÃ¼n efor aÃ§anlar ve kolay olanlar iÃ§in kÄ±sa notlar al. KÃ¼Ã§Ã¼k bir dÃ¼zenleme, zihinsel alanÄ± ferahlatÄ±r.\n\n'
        'Ã–neriler:\n'
        'â€¢ UyanÄ±r uyanmaz 3 cÃ¼mle rÃ¼ya Ã¶zeti.\n'
        'â€¢ GÃ¼n iÃ§inde 2 dakika nefes + omuz gevÅŸetme.\n\n'
        'Not: Bu yorum eÄŸlence amaÃ§lÄ±dÄ±r; kararlarÄ±nda sezgini ve gerekirse uzman gÃ¶rÃ¼ÅŸÃ¼nÃ¼ Ã¶ncele.'
      );
    }

    // Astro (daily) rich fallback â€” long, zodiac-aware
    if (type == 'astro') {
      String z = zodiac;
      String element = _inferElement(z);
      final tone = _pick(rnd, ['denge', 'akÄ±cÄ±lÄ±k', 'cesaret', 'netleÅŸme', 'huzur', 'odak']);
      final headline = _pick(rnd, ['Genel Enerji', 'GÃ¼nÃ¼n AkÄ±ÅŸÄ±', 'BugÃ¼nÃ¼n Ritmi']);
      final love = _pick(rnd, ['AÅŸk/Ä°liÅŸkiler', 'Kalp AlanÄ±', 'YakÄ±n Ä°liÅŸkiler']);
      final work = _pick(rnd, ['Kariyer/Para', 'Ä°ÅŸ ve Ãœretkenlik', 'Maddi AkÄ±ÅŸ']);
      final health = _pick(rnd, ['SaÄŸlÄ±k/Rutin', 'Ritim ve Beden', 'GÃ¼nlÃ¼k Rutin']);

      String elemLine(String e) {
        switch (e) {
          case 'AteÅŸ':
            return 'AteÅŸ elementi canlÄ±; giriÅŸim cesareti ve gÃ¶rÃ¼nÃ¼rlÃ¼k artÄ±yor. KÃ¼Ã§Ã¼k riskler, net adÄ±mlarla birleÅŸtiÄŸinde kapÄ±lar aralanÄ±r.';
          case 'Toprak':
            return 'Toprak elementi belirgin; somut ilerleme, dÃ¼zen ve kalÄ±cÄ±lÄ±k Ã¶n planda. KÃ¼Ã§Ã¼k ama istikrarlÄ± adÄ±mlar en iyi sonucu getirir.';
          case 'Hava':
            return 'Hava elementi etkin; fikir alÄ±ÅŸveriÅŸi ve iletiÅŸim akÄ±yor. DoÄŸru kelimeler, doÄŸru anda sÃ¶ylenince dengeler iyileÅŸir.';
          case 'Su':
            return 'Su elementi derin; sezgi ve duygusal berraklÄ±k destekleniyor. YavaÅŸlamak ve hisleri yazmak iÃ§ dengeyi kuvvetlendirir.';
          default:
            return 'BugÃ¼n denge ve farkÄ±ndalÄ±k temalarÄ± Ã¶ne Ã§Ä±kÄ±yor; kÃ¼Ã§Ã¼k niyetler bile alan aÃ§Ä±yor.';
        }
      }

      final sb = StringBuffer()
        ..writeln('$name, bugÃ¼n $z iÃ§in $tone Ã§aÄŸrÄ±sÄ± yÃ¼ksek. $headline:')
        ..writeln()
        ..writeln(elemLine(element))
        ..writeln('GÃ¼n iÃ§inde minik zaman pencereleri (10â€“15 dakika), Ã¶nemli olana odaklanmana yardÄ±m eder. Bir konuyu seÃ§ip sade bir hedef yazman yeterli.')
        ..writeln()
        ..writeln('$love:')
        ..writeln('Dinleme, bugÃ¼n iliÅŸkilerin ana anahtarÄ±. DuygularÄ±nÄ± kÄ±sa ve net cÃ¼mlelerle ifade et; â€œÅu anda ÅŸuna ihtiyacÄ±m varâ€¦â€ gibi ben-dili temiz bir kÃ¶prÃ¼ kurar. GeÃ§miÅŸten gelen bir dÃ¼ÅŸÃ¼nce dÃ¶ngÃ¼sÃ¼ fark edersen, onu kÄ±sa bir nefes arasÄ±yla nazikÃ§e serbest bÄ±rak.')
        ..writeln()
        ..writeln('$work:')
        ..writeln('PlanlarÄ±nÄ± Ã¼Ã§ kÃ¼Ã§Ã¼k adÄ±ma bÃ¶l. Ä°lk adÄ±m bugÃ¼n, ikincisi haftanÄ±n ortasÄ±, Ã¼Ã§Ã¼ncÃ¼sÃ¼ ise haftanÄ±n sonu iÃ§in. Zaman bloklarÄ± (25â€“30 dk) ve kÄ±sa esler, Ã¼retkenliÄŸi artÄ±rÄ±rken zihni berrak tutar. Bir dosya/posta/mesaj kapatmak, gÃ¶rÃ¼nmez yÃ¼kleri azaltÄ±r.')
        ..writeln()
        ..writeln('$health:')
        ..writeln('Bedene nazikÃ§e kulak ver. Omuz-boyun bÃ¶lgesinde hafif esnetmeler, 5â€“7 dakika yÃ¼rÃ¼yÃ¼ÅŸ ve bir bardak su ile ritmini tazele. Erken akÅŸam saatlerinde ekranÄ± kÄ±smen azaltmak, uyku kalitesini yÃ¼kseltir ve sabah netliÄŸini gÃ¼Ã§lendirir.')
        ..writeln()
        ..writeln('RitÃ¼el/Ã–neriler:')
        ..writeln('â€¢ ÃœÃ§ cÃ¼mle niyet: BugÃ¼n odak â€” ' + tone + '.')
        ..writeln('â€¢ 10â€“15 dk tek konu: Zihni daÄŸÄ±tan pencereleri kapat, tek hedefe odaklan.')
        ..writeln('â€¢ Su + nefes: 4 sayÄ±da al, 4 sayÄ±da ver; iki tur yeter.')
        ..writeln('â€¢ AkÅŸam kÄ±sa kapanÄ±ÅŸ: GÃ¼nÃ¼n bir cÃ¼mle Ã¶zeti ve bir cÃ¼mle ÅŸÃ¼kran.')
        ..writeln()
        ..write('Not: Bu yorum eÄŸlence amaÃ§lÄ±dÄ±r; kendi sezgini ve gerekirse uzman gÃ¶rÃ¼ÅŸÃ¼nÃ¼ Ã¶ncele.');

      return sb.toString();
    }
    // Astro / daily generic fallback
    final focus = _pick(rnd, ['iletiÅŸim', 'kariyer', 'yakÄ±n Ã§evre', 'aile', 'kendini ifade']);
    return '$name, bugÃ¼n $zodiac enerjisi $focus alanÄ±nda parlak.\n'
        'KÄ±sa bir meditasyon ve bir bardak su ile niyetini tazele.';
  }

  static T _pick<T>(Random r, List<T> list) => list[r.nextInt(list.length)];

  static String _inferElement(String z) {
    final t = z.toLowerCase();
    const fire = ['koÃ§', 'aslan', 'yay'];
    const earth = ['boÄŸa', 'baÅŸak', 'oÄŸlak'];
    const air = ['ikizler', 'terazi', 'kova'];
    const water = ['yengeÃ§', 'akrep', 'balÄ±k'];
    if (fire.any(t.contains)) return 'AteÅŸ';
    if (earth.any(t.contains)) return 'Toprak';
    if (air.any(t.contains)) return 'Hava';
    if (water.any(t.contains)) return 'Su';
    return '';
  }
}
    if (type == 'live_chat') {
      final tone = (extras?['tone'] ?? 'friendly').toString();
      final length = (extras?['length'] ?? 'medium').toString();
      final mood = _pick(rnd, ['sakin', 'samimi', 'neÅŸeli', 'toparlayÄ±cÄ±']);
      final vibe = _pick(rnd, ['iÃ§ sezgini dinlemek', 'net sÄ±nÄ±rlar koymak', 'kÃ¼Ã§Ã¼k ama somut adÄ±mlar', 'ÅŸefkatle kendine yaklaÅŸmak']);
      String opener;
      if (tone == 'spiritual') {
        opener = '$name, niyetinle hizalandÄ±ÄŸÄ±nda evren kapÄ±lar aÃ§ar; ÅŸimdi kalbine iyi gelecek olan $vibe gibi gÃ¶rÃ¼nÃ¼yor. Enerjin $mood; sezgi dalgan netleÅŸiyor.';
      } else if (tone == 'humorous') {
        opener = '$name, kalbini rahatlatan bir kahve molasÄ± ve $vibeâ€¦ Bazen evren de bildirimleri kapatÄ±p bize gÃ¼lÃ¼mser ğŸ™‚';
      } else {
        opener = '$name, bir dost gibi sÃ¶ylemek isterim: ÅŸu anda kalbini rahatlatan ÅŸey $vibe olacak. Enerjin $mood bir tonda; doÄŸru soruyu sorduÄŸunda cevaplar ortaya Ã§Ä±kÄ±yor.';
      }

      final tipA = _pick(rnd, [
        'Åimdi 3 derin nefes al; nefes verirken â€œbÄ±rakÄ±yorumâ€ diye iÃ§inden tekrarla.',
        'Konuyu tek bir cÃ¼mleyle yaz: â€œÅu anda ihtiyacÄ±m olanâ€¦â€. Bu cÃ¼mleyi telefonuna not et.',
        'KÄ±sa bir yÃ¼rÃ¼yÃ¼ÅŸ veya 2 dakikalÄ±k esneme, zihni berraklaÅŸtÄ±rÄ±r.',
      ]);
      final tipB = _pick(rnd, [
        'BugÃ¼n 10 dakikalÄ±k tek-odak zamanÄ± ayÄ±r. Bildirimleri kapat, sadece bir adÄ±m at.',
        'GÃ¼vendiÄŸin birine kÃ¼Ã§Ã¼k bir ricada bulun; destek istemek gÃ¼cÃ¼nÃ¼ azaltmaz.',
        'Uyumadan Ã¶nce 2 cÃ¼mle ÅŸÃ¼kran yaz; minik bir ritÃ¼el, bÃ¼yÃ¼k fark yaratÄ±r.',
      ]);

      final follow = _pick(rnd, [
        'Ä°stersen, aklÄ±ndaki asÄ±l soruyu tek cÃ¼mleyle paylaÅŸÄ±r mÄ±sÄ±n?',
        'Åu anda seni en Ã§ok zorlayan sahneyi bir cÃ¼mleyle tarif etsen nasÄ±l olur?',
        'BugÃ¼n atabileceÄŸin en kÃ¼Ã§Ã¼k adÄ±m sence hangisi?',
      ]);

      final b = StringBuffer()
        ..writeln(opener)
        ..writeln();
      if (length != 'short') {
        b
          ..writeln('Ã–neriler:')
          ..writeln('â€¢ $tipA')
          ..writeln('â€¢ $tipB')
          ..writeln();
      } else {
        b
          ..writeln('â€¢ $tipA')
          ..writeln();
      }
      if (profile.zodiac.isNotEmpty) { final elem = _inferElement(profile.zodiac); if (elem.isNotEmpty) b.writeln('\nAstro notu: ' + elem + ' elementi bugÃ¼n sezgini destekliyor.'); }\nb.writeln(follow);
      return b.toString();
    }

